<div class="cards-grid">
  {% for joke in jokes %}
    <div class="card card-bundle" onclick="openUnifiedModal('joke-detail', {
        id: {{ joke.id }}, 
        title: '{{ joke.title|e('js') }}', 
        description: '{{ joke.description|e('js')|raw }}', 
        image: '{{ joke.category and joke.category.viewImage ? asset('uploads/categories/' ~ joke.category.viewImage) : (joke.category and joke.category.previewImage ? asset('uploads/categories/' ~ joke.category.previewImage) : asset('images/placeholder.jpg')) }}', 
        price: {{ joke.price }}, 
        category: '{{ joke.category ? joke.category.name : 'Non catégorisé' }}', 
        categoryColor: '{{ joke.category ? joke.category.color : '#ccc' }}', 
        categoryIcon: '{{ joke.category and joke.category.icon ? joke.category.icon : '' }}'
    })">
      <div class="bundle-media">
        {% if joke.category and joke.category.previewImage %}
          <img src="{{ asset('uploads/categories/' ~ joke.category.previewImage) }}" alt="{{ joke.title }}" loading="lazy">
        {% else %}
          <img src="{{ asset('images/placeholder.jpg') }}" alt="Placeholder" loading="lazy">
        {% endif %}
      </div>
      <div class="bundle-body">
        <h5 class="bundle-title">{{ joke.title }}</h5>
        <span class="joke-category" style="background-color: {{ joke.category ? joke.category.color : '#ccc' }}" id="detail-category">
            {% if joke.category and joke.category.icon %}
            <i class="{{ joke.category.icon }} me-1"></i>
            {% endif %}
            {{ joke.category ? joke.category.name : 'Non catégorisé' }}
        </span>
        <div class="bundle-action-slot">
          <span class="bundle-price">€{{ joke.price|number_format(2, ',', ' ') }}</span>
          <button class="bundle-cta" 
                  onclick="event.stopPropagation(); openUnifiedModal('payment-card', {
                    id: {{ joke.id }}, 
                    title: '{{ joke.title|e('js') }}', 
                    description: '{{ joke.description|e('js')|raw }}', 
                    image: '{{ joke.category and joke.category.viewImage ? asset('uploads/categories/' ~ joke.category.viewImage) : (joke.category and joke.category.previewImage ? asset('uploads/categories/' ~ joke.category.previewImage) : asset('images/placeholder.jpg')) }}', 
                    price: {{ joke.price }}, 
                    category: '{{ joke.category ? joke.category.name : 'Non catégorisé' }}', 
                    categoryColor: '{{ joke.category ? joke.category.color : '#ccc' }}', 
                    categoryIcon: '{{ joke.category and joke.category.icon ? joke.category.icon : '' }}'
                  })"
                  aria-label="Acheter pour {{ joke.price|number_format(2, ',', ' ') }} euros">
             Acheter pour €{{ joke.price|number_format(2, ',', ' ') }}
          </button>
        </div>
      </div>
    </div>
  {% else %}
    <div class="text-muted py-5">
      Aucune blague trouvée.
    </div>
  {% endfor %}
</div>
